\chapter*{Úvod}

Webové technologie procházejí velkými evolučními proměnami. Internet
už není ono nové a neprobádané místo jako v 90. letech 20.
století, ale naopak se stal běžnou a často i nepostradatelnou
součástí života obyčejných lidí. Technologie se posunují vpřed
jednotně na základě konsensu lídrů trhu, aplikace se přesouvají z
operačního systému do prohlížeče a vyvíjí se pro ně uživatelská
rozhraní s ohledem na běžné lidi. Ti se vlastně dostali do středu
veškerého zájmu. Jestliže dříve byl internet místem spíše pro
technicky založené, nyní se snaží oslovit širokou veřejnost.

Různé zajímavé služby otevřeně poskytují svá data a na těch se staví
aplikace s dříve nepředstavitelnými komplexními funkcemi. Nejlépe to lze vidět
asi na mapách, které prošly neskutečným vývojem a dnes díky nim (když
zmíním jen zlomek jejich možností) například pohodlně naplánujete
cestu autem, zjistíte počasí v dané lokalitě, vyhledáte nej\-bližší
pekárnu, nebo si prohlédnete fotografie jiných lidí z míst, kam na
léto plánujete dovolenou. Na základě takových online map vznikají
mnohé specializované služby -- z těch nej\-zajímavějších v českém
prostředí bych zmínil například server bezrealitky.cz, jenž na
mapových podkladech zobrazuje realitní objekty. Nechal jsem se
inspirovat a na základě map jsem i já postavil systém, který využívá
mnoha otevřeně nabízených služeb a integruje je do komplexní aplikace
s užitkem pro běžného uživatele.

Evidencí geografických tras uživatele je tedy myšlena webová aplikace,
jež umožňuje uživateli interaktivně zaznačit do mapových podkladů trasu,
kterou plánuje absolvovat či kterou již absolvoval například na kole,
pěšky, na bruslích nebo během. Nic samozřejmě uživateli nebrání
evidovat i jiné, delší trasy, systém by měl být však primárně určen
pro výše naznačené lokální sportovní využití.

Bakalářská práce se postupně zabývá \ldots DOPSAT STRUCNE PRULET
OBSAHEM BP (KRATKY ODSTAVECEK).

Celkově chce práce uvést čtenáře do problematiky stavby webové
aplikace na základě různých API, osvětlit mu pojmy související s
problematikou a navést či pomoci při řešení některých tradičních
problémů, pokud by měl zájem podobnou aplikaci vyvíjet.

\chapter{Pojmy Web~2.0 a mashup}\label{mashup}

Dvacáté století nám připravilo univerzální platformu s obrovským
potenciálem. Lidé spojili inovativní myšlenky z mnoha směrů informatiky,
vybudovali fungující síť, úspěšně ji rozšířili po celé planetě
a dokázali z ní vytvořit každodenního pomocníka, bez kterého si život
už příliš představit nedokážeme. Kolem roku 2000 bylo na světě kolem
250~000~uživatelů internetu a toto číslo dále stoupalo exponenciálně
\footnote{Viz \url{http://www.internetworldstats.com/}.}.

Do nového století jsme však stále vstupovali spíše s pocitem, že
internet je něco nového a že tušíme minimum o tom, jaké jsou jeho
možnosti. Webové technologie byly celkem nesmělé, statické a pasivní.
Trh s prohlížeči, hlavními katalyzátory vývoje, byl nestabilizovaný.
Namísto toho, aby velcí hráči internetového trhu spolupracovali a v
navrhovaných novinkách se pokoušeli o konsensus, byly technologie
proprietárně uzamykány.

Až dnes se postupně dostáváme do doby, kdy můžeme pracovat s
relativně jednotně podporovanými technologiemi, kdy se prosazují
spíše otevřená řešení a kdy začínají internetové subjekty
spolupracovat mezi sebou a více využívat možností propojení pomocí
internetu. Evoluce přinesla novou éru webu, brzy pojmenovanou jako
{\it Web~2.0} \cite{web20}. Začaly se objevovat složité interaktivní
aplikace přímo ve webovém prohlížeči, stránky přestaly být izolovanými ostrůvky
statických informací, ale naopak mezi sebou začaly kooperovat,
poskytovat si navzájem data a funkcionalitu. Masivní rozšíření
internetu mezi běžné uživatele podnítilo vznik tzv. {\it sociálních
služeb}, kde mohou lidé sdílet informace mezi sebou a snadno
komunikovat, a také přineslo požadavek na propracovanější a
příjemnější uživatelské rozhraní webových aplikací.

Velmi mnoho nových Web~2.0 služeb dnes nabízí své aplikační
rozhraní (API, {\it Application Programming Interface}) k volnému
využití. Kombinací těchto API vznikají velmi silné aplikace, postavené
pomocí minima programování a maximálního využití hotové funkčnosti.
Taková architektura se dnes označuje běžně jako mashup (míchanice).

Do kontextu tohoto nového proudu jsem se rozhodl zasadit svou práci a
vytvořit právě výše zmíněný mashup. Má aplikace využívá mnoha služeb a
datových zdrojů poskytovaných otevřeně a online, spojuje je dohromady
a staví na nich novou službu pro běžného netechnického uživatele.
Navíc nabízí dle trendů interaktivní uživatelské rozhraní a snaží se
uživateli poskytnout prostor pro sdílení svých dat s ostatními.

Zajímavě problematiku mashupů zpracoval ve svém článku
\cite{certodejMashup} český internetový novinář a podnikatel Patrick
Zandl. Na téma API se v seriálu \cite{misantropApi} rozepsal Martin
Malý.

\chapter{Analýza a specifikace požadavků}

Jak jsem již pro osvětlení zmínil v úvodu práce, evidencí
geografických tras uživatele se rozumí webová aplikace, umožňující
člověku pohodlně a interaktivně zaznačit do mapových podkladů trasu,
kterou plánuje absolvovat či kterou již absolvoval například na kole,
pěšky, na bruslích nebo během. Nic samozřejmě uživateli nebrání
evidovat i jiné, delší trasy, systém by měl být však primárně určen
pro výše naznačené lokální sportovní využití.

Aplikace je službou, kam se uživatel zaregistruje a potom,
přihlášen na svůj účet, může zakládat trasy svých výletů. Ty má
možnost ukládat a zpětně prohlížet. Trasy jako takové neposkytují jen
interaktivní záznam cesty na mapovém podkladu, ale také statistiky a
běžné informace o trase. Zde je prostor pro kombinaci s dalšími
podklady –- například s informacemi o nadmořské výšce terénu lze
uživateli poskytnout navíc výškový profil jeho trasy. Uživatel má
možnost trasy i plánovat. V tomto režimu aplikace vykazuje statistiky
trasy a může využít zase jiných datových zdrojů, aby poskytnula lepší
obraz o tom, co může například běžce na trase potkat (to může být
opět výškový profil, ale také např. předpověď počasí pro místo trasy
nebo vrstva s fotografiemi místních zajímavostí či panoramat).

Integrace s jinými zdroji dat potom může zasahovat i do zcela jiných
sfér –- např. by mohlo být možné implementovat výměnu dat s přenosným
GPS zařízením.

\section{Cílení projektu}
Cílovou skupinou projektu jsou běžci, pěší turisté, cyklisté,
běžkaři, bruslaři, jezdci na koních a třeba i vodáci. Je tedy
důležité si uvědomit, že projekt pracuje s uživatelem, jenž nemusí
být nijak technicky vzdělán, takže by mu měl nabídnout srozumitelné a
příjemné uživatelské prostředí. Během výběru mapových podkladů (viz
\ref{vybermap}) však také vyvstává otázka, zda projekt cílit pouze na
Českou republiku, nebo počítat s uživatelskou základnou z celého světa.

Cílit mapový projekt celosvětově totiž neznamená jen lokalizovat
systém přinej\-menším i do angličtiny, ale také mít k dispozici dobré
globální mapové podklady a s nimi samozřejmě také všechna použitá
API. Území Česka a Slovenska má jednu z nej\-dokonalejších a nej\-hustších
sítí turistického značení pro pěší turistiku \cite{kct}.
Podobné značení má také Polsko, ale jinak je takováto síť prakticky světově unikátní. To
znamená pro mou aplikaci především skutečnost, že pokud chce
poskytovat možnost zobrazení těchto tras, musí využít lokálního
poskytovatele mapových podkladů. Na druhou stranu bude potom
funkčnost systému omezena prakticky na jeden stát, protože kvalitní a
podrobné mapové podklady místních poskytovatelů nejsou v zásadě
celosvětové.

Nabízí se dvě možnosti -- zda se vydat cestou horších podkladů, ale
oslovením větší uživatelské základny, nebo zkusit oslovit maximum
uživatelů na domácím trhu a moci odrážet jeho lokální specifika. Dá se
říci, že Češi jsou pro výše zmíněnou turistickou činnost dosti
zapálení \cite{turistika} a proto lze očekávat, že hustota
potencionálních uživatelů systému by zde byla mnohem vyšší než v
jiných zemích, i přes zdánlivě malý, desetimilionový trh.

Specifika českého turismu, existence celosvětově operujících
konkurenčních projektů jako např. MapMyRun.com a absence vážné
konkurence na domácím trhu mě přivedla k rozhodnutí cílit aplikaci
pouze na Českou republiku. Jak se lze dočíst v \ref{vybranamapa},
využívám tedy nakonec podkladů lokálního poskytovatele. Navíc jsou
často na ČR omezeny i jiné zdroje dat a celý systém je pouze v
češtině.

\chapter{Výběr aplikačních rozhraní a zdrojů dat}
Evidence geografických tras uživatele je aplikací postavenou na
architektuře mashup (viz \ref{mashup}), a proto je výběr API již z
principu zcela zásadní. S ohledem na tuto skutečnost problematice
věnuji velký následující úsek práce.

\section{Specifika práce na základě API}
Vystavět aplikaci z větší části na externích zdrojích přináší možnost
využít již hotových, profesionálních a ihned funkčních řešení a služeb
od specializovaných poskytovatelů. Kdybychom si například chtěli sami
naprogramovat mapový systém, stálo by nás to nemalé prostředky a
rozsahem problému bychom překročili celou tuto práci. Stejně tak by
nebylo snadné zajistit si svá vlastní geografická data s nadmořskými
výškami nebo aktuální informace o počasí. S použitím API se na tyto
problémy nemusíme soustředit a s využitím minima úsilí spojujeme
existující prostředky do velmi silných aplikací.

Přístup samozřejmě ale přináší také nevýhody. Zdroje dat nejsou nijak
v naší moci a proto hrozí riziko prodlev či nedostupnosti služeb v
případě lepším, v tom horším potom jejich neaktuálnost, chybovost, nebo
dokonce zánik. Prodlevy v odpovědích z cizích serverů musí program
zohlednit, zabývat se synchronizací požadavků s interaktivním
uživatelským rozhraním a zamezit kolizím. Pokud navíc hrozí, že 
prodlevy budou dlouhé a znepříjemní uživatelský prožitek, je dobré
funkci, která je způsobuje separovat a dát uživateli možnost ji
vypínat a zapínat. Rizika s vážným dopadem na funkčnost programu může
potom aplikace postavená nad API ošetřovat především omezením své
závislosti na jediném poskytovateli dat.

U mapových podkladů si takové řešení můžeme představit například v
naprogramování vrstvy, která nám poskytne rozhraní k funkcím API,
ale oddělí nás od jejich konkrétní implementace. Vrstva potom může
obalovat API Google Maps, Mapy.cz i Amapy.cz (viz \ref{vybermap}) a
konkrétní službu potom použít na základě jediného parametru, podobně
jako se to dělá například u databázových vrstev s abstrakcí
několika druhů SŘBD. Podobný projekt již existuje a nese název
Mapstraction\footnote{Aktuální zdrojové kódy jsou k dispozici na
\url{http://code.google.com/p/mapstraction/}.}, ale je ve velmi ranném stádiu a navíc podporuje zatím pouze globální
mapové systémy. Využití jeho zdrojových kódů a případné zanesení českých
mapových API je nyní tedy spíše zajímavou ideou do budoucna.

U ostatních podkladů není omezování rizik tak obtížné. Pokud má
aplikace na výběr z několika podkladů, může jednoduše použít lepší z
nich a pokud ten selže, ve výjimce se na data dotáže alternativního,
byť třeba méně přesného. Takto jsem zdvojil například API pro
získávání nadmořské výšky (viz \ref{vyskovyProfil}).

\section{Mapové podklady}\label{vybermap}
V oblasti mapových technologií na internetu proběhl v
posledních letech opravdový zlom. Vše začalo 8. 2.
2005 \cite{gmaps}, kdy Google spustil své revolučně zpracované,
interaktivní Google Maps. V řetězové reakci si postupně i další
provozovatelé online map začali uvědomovat skrytý potenciál této
služby (prodej regionální reklamy, cílená reklama, partnerství s
jízdními řády apod.) a začali také investovat velké částky do její
modernizace. Na českém internetu navíc vznikly časem tři velké a
velmi kvalitní mapové servery, což je ve světě celkem jedinečný úkaz
a působí ještě unikátněji, přihlédneme-li k velikosti a významu naší
země.

Ještě v roce jejich vydání představil Google jako první u svých
map aplikační rozhraní pro použití mapových podkladů i na jiných
webech. Vydání API se setkalo s obrovským ohlasem \cite{gmapsSuccess}
a nadobro změnilo web, jak jsme ho znali. Po celém internetu se začaly objevovat
interaktivní mapy -- od jednoduchých orientačních výřezů po aplikace
na mapách kompletně založené. Konkurence ani nyní nespala a odpověděla
svými vlastními API.

V následujících odstavcích se pokusím popsat specifika, výhody a
nevýhody jednotlivých mapových podkladů, jež jsem bral pro svou práci
v úvahu. Je nutné podotknout, že samotných mapových serverů je mnohem
více (např. Mapy iDNES.cz, Yahoo! Maps, Ask.com Maps \& Directions,
Multimap, NAVTEQ Map24, Bing Maps, aj.), ale nelze jejich služeb využít,
protože poskytované datové podklady nejsou dostatečné pro Českou
republiku, API vůbec nenabízejí, nebo má velmi omezené možnosti. Také
jsem vynechal možnost získat geografická data jejich zakoupením přímo od dodavatelů.

\subsection{Google Maps společnosti Google}
Průkopník v oblasti online map, Google, nabízí samozřejmě mapový
server i API již hodně dlouho, takže jeho služby jsou v mnoha směrech
nej\-vyzrálejší. API je pod neustálým vývojem a v době psaní práce
Google pracuje na jeho třetí
verzi\footnote{V době psaní práce dostupné na
\url{http://code.google.com/intl/cs/apis/maps/documentation/v3/}.}.

Nelze se však nechat unést jeho možnostmi a je nutné zaměřit se i na
jiné rysy, důležité pro tuto práci. Mezi takové patří
například skutečnost, že do češtiny začala být služba lokalizována až
nedávno \cite{googleCesky}.
Dnes je již sice míra integrace map do českého prostředí na velmi
dobré úrovni, ale z hlediska mapových podkladů má jednu velkou mezeru
-- turistická data. Google poskytuje mapy globálně a proto se mu v
nich velmi špatně odráží specifika jednotlivých zemí. K dispozici
jsou sice terénní mapy s vrstevnicemi, ale neexistuje možnost
zobrazit na nich české turistické trasy a cyklostezky.

Jinak jsou podklady kvalitní, i když někdy méně přesné, než u
lokálních mapových služeb. Google používá kombinaci několika zdrojů
geografických map, přičemž většinu českých podkladů získává od
dodavatele GEODIS Brno. Předností map je samozřejmě dostupnost
podkladů pro celý svět a lákavá je rovněž představa možného budoucího 
napojení aplikace např. v podobě vrstvy na program Google
Earth\footnote{Google Earth je multiplatformní program společnosti
Google představující virtuální online glóbus. Nabízí pohled na zemi
jako z družice, virtuální 3D modely některých měst, detailní snímky
zajímavých míst po celém světě a umožňuje překryv mapových podkladů
tzv. vrstvami poskytujícími další informace. Google jej nabízí v
několika variantách, z nichž základní je zdarma.}.

\subsection{Mapy.cz společnosti Seznam.cz}
Mapy.cz byly prvním ryze českým projektem v oblasti nových online map
a dodnes jsou lídrem lokálního trhu. Stejně jako za Google Maps stojí
i za těmito mapami silná společnost. Budoucnost serveru a případný
další vývoj API je celkem jistý. Seznam.cz se na rozdíl od všech
ostatních českých portálů profiloval po vzoru Google spíše do
společnosti, jež svou budoucnost spojuje s technologickým pokrokem,
než do mediálního vydavatelství jako například Centrum Holdings.
Odhadnutelné záměry potvrdili uveřejněním zprávy o vývoji nového
API \cite{apiSeznam} v době tvorby této práce.

Současný stav API je ale celkem nešťastný. Aplikační rozhraní nabízí
jen omezenou škálu funkcí, omezené mapové podklady oproti službě
Mapy.cz a samotná práce s funkcemi API působí na vývojáře poněkud
těžkopádně. Jeho licenční podmínky navíc nejsou tak volné jako u
ostatních API a požadují registraci klíče nikoliv na doménu, ale
přímo na unikátní URI, kde se má mapa nacházet. To jej pro tvorbu
složitější aplikace prakticky vyřazuje ze hry. V podmínkách je také
omezení na 1000 zobrazení denně a zákaz provozu map pro komerční
užití, což v ranné fázi projektu není velkou překážkou, ale pro
budoucí rozvoj projektu ano.

Nové API čtvrté verze vyvíjí v Seznam.cz Ondřej Žára, autor známého
nástroje pro tvorbu databázových schémat, {\it WWW SQL
Designer}\footnote{Dostupné na
\url{http://code.google.com/p/wwwsqldesigner/}.}, což je určitou zárukou kvality. Bohužel rozhraní je zatím stále dost
nestabilní a podle jeho slov na diskusi k projektu ani jemu stále
ještě nejsou známy nové licenční podmínky.

Mapy.cz jsou připraveny kombinací geografických dat od PLANstudio a
GEODIS Brno. Turistická mapa je nej\-kvalitnější podobnou mapou na českém
internetu. Seznam.cz ji poskytuje na základě dat společnosti SHOCart,
známou svými papírovými turistickými a cyklistickými publikacemi. Je
škoda, že nepoužitelné API v tomto případě brání využít tak kvalitní
podklady.

\subsection{Amapy.cz společnosti Centrum Holdings}
Amapy.cz se na svět dostaly v roce 2006 pod hlavičkou portálu
Atlas.cz. Ihned od představení (viz \cite{amapy}) bylo jasné, že se s
nimi musí na českém trhu počítat -- zpracování bylo profesionální a spolu s mapami přišlo
i první, na funkce bohaté, dobře dokumentované české mapové API. Vývoj
však postupně ustával a po tom, co byl Atlas.cz sjednocen s
Centrum.cz pod hlavičku Centrum Holdings, nelze již kolem API
pozorovat vůbec žádnou činnost ze strany provozovatele. Celou službu
původně zpracoval Daniel Steigerwald, který tyto informace pro mou
práci potvrdil
\footnote{Viz \url{http://twitter.com/steida/statuses/2211073537}.}.

API je však opravdu velmi dobře použitelné a mapové podklady
kvalitní, připravené ve spolupráci s firmou DPA. I přes API lze
dokonce zobrazovat vrstvy s turistickými a cyklistickými značkami a už i
zcela základní mapa disponuje vrstevnicemi. Aplikační rozhraní nabízí
funkce, jež nelze najít ani u Google Maps API a podporuje několik
souřadnicových systémů naráz, což je výhodné při spolupráci s jinými
službami (každá požaduje body v jiném formátu).

Specifikem API je integrovaný JavaScriptový framework MooTools 1.11.
Výhodou je, že po vložení API do stránky lze přímo využít všech výhod
frameworku a není nutné nějaký připojovat dodatečně. Nevýhodou je
nemožnost vlastního výběru frameworku a také ustrnutí vývoje API,
protože v důsledku toho nebyl průběžně framework obnovován a zůstal
v API ve verzi 1.11, ačkoliv během psaní práce byl vydán již ve
velmi odlišné verzi 1.2.3.

\subsection{Otevřený projekt OpenStreetMap}
OpenStreetMap je otevřený projekt, který se snaží vytvořit volně
dostupná geografická data. Získává je integrací dat z různých zdrojů
a především individuálním sběrem dat pomocí GPS zařízení. Mnoho
institucí, ogranizací a dokonce i firem uvolnilo svá data pod licencí
kompatibilní s OpenStreetMap, aby tomuto projektu pomohli.

Kvalita mapových podkladů pro ČR však není zrovna nej\-lepší a
pro účely aplikace se nehodí ani forma jejich zobrazení. Mapy sice
obsahují například polohu sloupů elektrického vedení nebo přesné
hranice lesů, vrstevnice nebo turistické značky a cyklostezky však
nepodporují.

OpenStreetMap je zajímavý počin a do budoucna možná perspektivní, ale
o jeho použití ve své práci jsem příliš neuvažoval. Uvedl jsem jej
pro úplnost jako alternativní a otevřený zdroj geografických dat,
jenž by v budoucnosti mohl nabýt na relevanci.

\subsection{Výběr API s ohledem na požadavky a cílení
práce}\label{vybranamapa}
Z charakteru aplikace, jež je předmětem této práce, celkem jasně
vyplývá, že výběr mapových podkladů je jedním z nej\-důležitějších
rozhodnutí, které bude mít vliv na celý další vývoj projektu.
Soustředil jsem se proto opravdu pečlivě na vlastnosti
jednotlivých API a dlouze zvažoval.

Vzhledem k faktům zmíněným v předcházejících odstavcích jsem však
postupně nabyl dojmu, že ani jedno řešení rozhodně nelze favorizovat a
spíše bude nutné vybrat nej\-méně bolestivý kompromis. Vybíral jsem
podle třech hlavních kritérií:
\begin{itemize}
	\item Možnosti a funkce API,
	\item kvalita mapových podkladů s důrazem na turistické
	mapy a možnosti zobrazovat české turistické značky a cyklictické
	trasy,
	\item zázemí poskytovatele a budoucnost API.
\end{itemize}

Google nabízí bezkonkurenční API a dokonce v současné době
představuje jeho zcela novou verzi, ale jeho mapové podklady jsou pro turistiku v
českých podmínkách naprosto nedostatečné. Mapy.cz naopak disponují
vynikajícími mapovými podklady, jenomže jejich aplikační rozhraní je
velmi chabé z hlediska funkcionality a ještě mnohem více omezující v
oblasti licenčních podmínek jeho použití. Seznam.cz sice vyvíjí nové
API, ale to je zatím velmi nestabilní a jeho licence je stále
neznámá. Pro svou práci jsem tedy nakonec vybral podklady od Centrum
Holdings, protože poskytují dobré turistické mapy a mají bohatou
škálu funkcí. S faktem, že vývoj aplikačního rozhraní je již několik
let zcela mrtvý a jeho budoucnost je nejistá, mi nezbylo než se
smířit a počítat s tím, že v budoucnu ji možná bude zapotřebí přepsat
pro jiné API. V tomto ohledu bych vzhlížel k vývoji nového API v Seznam.cz.

\section{Výškový profil}\label{vyskovyProfil}
\subsection{Nadmořská výška}\label{vyskopis}
Existují de facto dva hlavní zdroje dat o nadmořské výšce.
Český Výškopis.cz (celosvětově pod názvem Topocoding.com) a potom
jeden ze škály zdrojů dostupných na GeoNames.org.

Výškopis.cz na svých stránkách představuje ukázky JavaScriptového API
přímo na všech třech českých mapových systémech a má dokonce přímou funkci pro
vygenerování výškového profilu Na druhou stranu má však mírně
omezující podmínky (počet požadavků za 24 hodin může být
limitován na 10000) a hlavně nejsou nikde k dispozici nejen kontaktní
údaje, ale ani název provozovatele. Nicméně služba funguje a
její topografická data jsou kvalitní kombinací SRTM3 a GTOPO30 -- pro
většinu území mají horizontální rozlišení kolem 90 metrů
\footnote{Viz popis služby dostupný na
\url{http://www.vyskopis.cz/index.php?option=com_content&task=view&id=1&Itemid=9}.}.

GeoNames.org poskytují pouze data z
GTOPO30, takže dosahují rozlišení asi jednoho kilometru
\footnote{Viz dokumentace k API dostupná na
\url{http://www.geonames.org/export/web-services.html\#gtopo30}.}. GeoNames.org jsou široce využívaným a známým \footnote{Seznam uživatelů obsahuje společnosti jako BBC, Adidas nebo Nike -- viz \url{http://www.geonames.org/users.html}.} poskytovatelem nej\-růz\-něj\-ších dat, takže jej zřejmě lze považovat za spolehlivý.

Pro svůj projekt jsem se rozhodl použít jako primární zdroj dat
Výškopis.cz a v podobě záložního jsem implementoval API s méně
přesnými výsledky od GeoNames.org.

\subsection{Grafy}\label{grafy}
Pro zobrazení výškového profilu uživateli je potřeba mít možnost
dynamicky vygenerovat spojnicový graf. Dalo by se použít přímé funkce
aplikačního rozhraní služby Výškopis.cz (viz \ref{vyskopis}), ale
výsledná podoba jejich grafu není příliš parametrizovatelná a navíc by
jeho implementace vázala důležitou část aplikace na jedno konkrétní API.

Profil se dá pomocí výškopisných dat generovat jednoduše i s
vlastními nástroji, pokud má aplikace k dispozici potřebná data na
trase. Vybíral jsem mezi povedenou PHP knihovnou pro generování
grafů {\it pChart}, interaktivní Flash knihovnou {\it Open Flash Chart
2} a vzdáleným REST rozhraním {\it Google Chart API} (viz \ref{rest}).
Knihovny by zřejmě dokázaly poskytnout sofistikovanější
výstup, ale hledal jsem spíše rychlé a jednoduché řešení a tím se
ukázalo být Google Chart API. V případě, že by v budoucnu svými
základními funkcemi nedostačovalo, je zde vždy možnost nahradit jej
jednou z výše zmíněných knihoven.

\section{Obraz z terénu}
\subsection{Fotografie}
panoramio atd.
\subsection{Webkamery}
\ldots

\section{Počasí}
\ldots

\section{Užitečná turistická data}
\subsection{Wikipedia}
\ldots
\subsection{Zdroje POI}
\ldots
\subsection{MHD}
\ldots
\subsection{Občerstvení}
\ldots

\chapter{Interoperabilita aplikace}
Pojem interoperabilita lze vysvětlit jako schopnost vzájemně si
rozumět, vzájemně spolupracovat, dosáhnout vzájemné součinnosti. V
kontextu této práce jsem pojem převedl především na součinnost s
okolím. V rámci webu jde například o autentizaci, mikroformáty nebo
spolupráci s geografickými nástroji od společnosti Google, významná je
však také interoperabilita mimo internet -- s přenosnými GPS systémy,
jež se stávají stále populárnější mezi běžnými lidmi.

Jelikož je kooperace webových služeb a vzájemná kompatibilita dnes
jednou z nejvíce progresivních myšlenek, dotknul jsem se v této části
práce nejvíce technologií a standardů, jež bychom mohli označit za
moderní a nově vznikající.

\section{Autentizace uživatele}\label{openid}
Na internetu se začíná prosazovat nový trend v podobě sjednocování
způsobu přihlašování do webových aplikací. Aby uživatel nemusel na každé
službě provádět opakovaně registraci, vymýšlet nová
přihlašovací jména, hesla a udržovat desítky různých účtů, vznikl v
posledních letech standard s názvem {\it OpenID}. Jedná se o
otevřenou a decentralizovanou metodu pro ověřování uživatelů, pro niž
deklarovaly nebo dokonce už i zrealizovaly svou podporu společnosti
jako Google, IBM, Microsoft, Yahoo!, BBC, Yandex, SourceForge, MySpace
nebo Seznam.cz \cite{dataportability}. Popis přesného fungování technologie
OpenID přesahuje rámec této práce a díky oficiální knihovně pro PHP
se ani při stavbě projektu nebylo zapotřebí obeznamovat s detaily
implementace. Proto uvedu myšlenku OpenID jen ve zkratce.

Identita OpenID není spravována jednou centrální autoritou. Uživatel
si může sám vybrat registrátora OpenID, kterému důvěřuje a jemuž
poskytne svá osobní data. Identifikátor má tvar běžné adresy webové
stránky, kterou má namísto tradiční dvojice {\it jméno \& heslo}.
Systém funguje tak, že uživatel zadá v klientské aplikaci svůj
identifikátor (např. {\tt uzivatel.myopenid.com}) a ta zašle
požadavek na registrátora (v tomto případě {\tt myopenid.com}).
Registrátor si s aplikací vymění klíče a ta uživatele přes HTTP
přesměruje na přihlašovací stránku OpenID providera. Zde uživatel
zadá své heslo, jediné, které si musí zapamatovat, společné pro
všechny služby podporující OpenID. Proběhne ověření identity a
přesměrování zpět na klientskou stránku, opět pomocí HTTP. Aplikace
nakonec ověří klíče a některá metadata a proces zakončí přihlášením
uživatele. Další podrobnosti a způsoby vlastní implementace jsou
dobře popsány v osvětovém seriálu Martina Malého \cite{openid}.

Díky tomu, že si aplikace může po registrátorovi vyžádat některá
základní data o uživateli, lze na jednoduchých službách zcela
vypustit registraci (neboli provozovat tzv. {\it tichou} registraci
při prvním přihlášní uživatele), což je pro návštěvníky nadmíru
pohodlné. Přesně této skutečnosti jsem využil i na popisovaném
projektu. Minimum nej\-důležitějších informací aplikace získá z OpenID
identity a doplňkové údaje si potom uživatel může sám vyplnit
dodatečně v nastavení svého účtu.

I vzhledem k současné podpoře OpenID je vše teprve v začátcích a
povědomí o službě není tak velké. Mohlo by být tedy celkem rizikové
metodu nasadit jako jediný způsob registrace a přihlášení do aplikace.
Protože ale OpenID nasadil i hegemon českého internetu
Seznam.cz\footnote{Nápověda
k OpenID je na \url{http://napoveda.seznam.cz/cz/login/openid/}.}, u
něhož většina Čechů účet má, rozhodl jsem se tuto nej\-pokrokovější metodu autentizace implementovat opravdu bez alternativy. Získání
OpenID od Seznam.cz je navíc velmi snadné -- stačí ve své e-mailové
adrese (např. {\tt uzivatel@seznam.cz}) zaměnit znak zavináče za
písmena {\tt id} oddělená tečkami ({\tt uzivatel.id.seznam.cz}).

\section{Import a export dat}
Jak bylo zmíněno v úvodu kapitoly, přenosné GPS systémy se stávají
mezi běžnými lidmi stále populárnější. Jejich příznivější ceny
způsobují, že je v dnešní době vlastní již nejeden běžec či cyklista.
Možnost importu a exportu zaznamenané trasy by tedy měla být spíše
jednou z hlavních než doplňkových funkcí výsledné aplikace. Při
jejich implementaci jsme navíc už jen krok od interoperability s
geografickými aplikacemi jako Google Earth nebo Google Maps. Ty
podporují buď přímo formát přenosných GPS zařízení, nebo vyžadují
svůj, který je ale velmi podobný, protože je rovněž založen na XML
(viz \ref{xml}).

\subsection{GPS eXchange Format}
GPS navigace většinou operují v rámci svých vlastních, uzavřených
formátů. Naštěstí se v oblasti těch ručně přenosných vytvořil de
facto standard v podobě GPX, formátu velmi rozšířeného výrobce GPS
navigací, společnosti Garmin. GPX je aplikací univerzálního jazyka
XML a jeho schémata jsou veřejně dostupná\footnote{Viz
\url{http://www.topografix.com/gpx/1/1/}.}.

\subsection{Keyhole Markup Language}
Společnost Keyhole, která vytvořila formát KML, již dnes přežívá
právě jen v jeho názvu. Tvůrce programu, jenž dnes známe pod jménem
Google Earth, pohltil vyhledávací gigant již v roce
2004\footnote{Podrobnosti dostupné na
\url{http://www.google.com/press/pressrel/keyhole.html}.}, tři roky od
jeho založení.

KML je stejně jako GPX aplikací jazyka XML a stalo se vedle něj
druhým používaným a uznávaným standardem pro záznam geografických
dat. Existuje i jeho komprimovaná verze pod názvem KMZ. Trasu
exportovanou do KML lze zobrazit nejen v programu Google Earth, ale
také online na Google Maps, což je funkčnost poněkud revoluční. Pokud
totiž na Google Maps takovýmto způsobem napojíme online generovaná
KML, lze vytvářet dy\-na\-mic\-ky aktualizované uživatelské
mapy\footnote{Malá ukázka je k dispozici např. ve formě zobrazení tras Tour de France
2005 --
\url{http://maps.google.com/maps?q=http://kml.lover.googlepages.com/leTourDeFrance2005.kmz&t=k}.}.
Přitom ke spojení stačí zadat adresu KML či KMZ souboru do vyhledávacího pole online map.

Generovat KML opět není nijak obtížné. Formát je otevřený a nabízí na
webu ucelenou dokumentaci\footnote{Viz
\url{http://code.google.com/intl/cs/apis/kml/}.}.

\section{Mikroformáty}\label{microformats}
Mikroformáty jsou způsob, jak do webových stránek vkládat strojově
čitelnou informaci a přitom zůstat v rámci syntaxe na možnostech
existujících HTML značek a atributů. Dají se tedy pochopit také jako
cesta, jak vytvořit aplikační rozhraní přímo v HTML kódu bez
speciálních exportů do jiných formátů jako JSON nebo XML (viz
\ref{api}). Automatické nástroje (ať už klientského či robotického
charakteru) totiž potom mohou podle určitých pravidel přes DOM (viz
\ref{javaScript}) přistoupit k hodnotám jednotlivých položek
mikroformátu a pracovat s nimi.

Mikroformáty se postupně rozšiřují a získávají si oblibu i přesto, že
zatím neexistuje příliš klientských nástrojů ani mashupů s jejich
podporou. S přibývajícím výskytem sémanticky vyznačeného kódu u
poskytovatelů dat lze však očekávat, že se brzy objeví. Ukázku
mikroformátů v akci lze koneckonců spatřit i na webu
fakulty, např. u stránky s profilem vedoucího této práce
\url{http://www.fit.vutbr.cz/~hruska/}.

Při tvorbě práce však zřejmě mikroformáty nebude možné příliš využít.
Množiny specifikovaných mikroformátů a prvků stránek použitých v
projektu se totiž příliš neprotínají. Na několika místech by šlo
implementovat například
hCard\footnote{Viz
specifikace \url{http://microformats.org/wiki/hcard}.} –- pro
vyznačení adresy uživatele (výchozí lokace na mapě) nebo provozovatele služby. Z ostatních mikroformátů je zajímavý především
geo\footnote{Viz specifikace \url{http://microformats.org/wiki/geo}.},
který specifikuje zaznačení zeměpisných souřadnic do webové stránky.
Nachází se však zatím v rozpracovaném stavu a je označen jako
koncept\footnote{Tato skutečnost ale například nijak nebránila vyhledávači Seznam.cz
přidat pro něj podporu \cite{geoSeznam}.}.

Velmi aktivně se o technologie mikroformátů v České republice zajímá
Martin Hassman \cite{mfLupa}. Komplexní seriál o problematice vyšel
na serveru Zdroják.cz Janu Sládkovi \cite{mf}.

\chapter{Použité technologie}
CITACE! CITACE! CITACE! CITACE! CITACE! CITACE! CITACE! CITACE!

Množina technologií použitých na tomto projektu by se dala označit v
rámci webového kontextu za vyloženě tradiční. Experimentům s ne tak
rozšířenými technologiemi brání v rámci malých projektů špatná
dostupnost jiných hostingových služeb, než těch pro jazyk PHP. Lze samozřejmě
připravit vlastní instalaci serveru nebo využít služeb
specializovaných hostingových programů, ale to by pro aplikaci do
budoucna znamenalo velmi omezenou přenosnost a udržovatelnost. Pro
použití tradičních webových jazyků také hovoří existence mnoha
hotových řešení, podpůrných knihoven a podpory nástrojů a návodů.

V oblasti uživatelského rozhraní navíc ani velký prostor pro výběr
není. Dá se sice uvažovat o použití technologií jako Adobe Flash, Microsoft
Silverlight apod., ale ty vyžadují zásuvné moduly na straně klienta
a to velmi omezuje jejich přístupnost. Lze namítat, že ani jazyk
JavaScript není podporován mnoha zařízeními, je ovšem alespoň
standardem nezávislým na operačním systému a podporovaném napříč všemi
moderními prohlížeči. V poslední době jej začínají implementovat i
nejnovější mobilní zařízení.

V mnoha případech jsem využil výhod frameworků, tedy komplexů
knihoven řešících rutinní problémy v daných jazycích a usnadňující
programátorovu práci. Ten se může soustředit na řešení samotného
problému, místo aby se většinu času zabýval \uv{vynalézáním kola}.

Ke konci kapitoly se zabývám použitím technologií souvisejících s API
jako architekturu REST nebo formáty XML a JSON.

\section{Uživatelské rozhraní webové stránky}
Uživatelské rozhraní webových aplikací je tvořeno kombinací
značkovacího jazyka, stylu a případně skriptů. Výsledek se často mezi
webovými tvůrci označuje jako tzv. {\it šablona webu} nebo {\it kód
webu}.

Značkovací jazyk je zpravidla z rodiny HTML či XML a slouží k
zaznamenání sémantiky dokumentu. Styl, připojovaný většinou v podobě
externího souboru, slouží k definici vzhledu dokumentu. Pro HTML je
to nejčastěji CSS, zatímco v aplikacích XML se setkáme asi spíše s
XSL. Třetí vrstvou bývá v  moderních projektech skriptovací
jazyk, jenž se spouští na klientském prohlížeči během a po vykreslení
webové stránky. Má schopnost dynamicky měnit obsah i styl dokumentu, v
čemž mu pomáhá úzká spolupráce s technologií DOM. Takovým skriptovacím
jazykem je dnes již prakticky pouze JavaScript, jemuž se za svou
existenci podařilo dospět do široce podporovaného jazyka a který z
webu vytlačil všechny své potencionální konkurenty (např. VBScript
společnosti Microsoft).

\subsection{Sémantický dokument s HTML}
HTML ({\it HyperText Markup Language}) je jazyk pro snadné
značkování dokumentů a jejich šíření po webu přes protokol HTTP. Tim
Berners-Lee jej spolu s tímto protokolem v roce 1990 sestavil, aby
pro svět objevil technologii webu. HTML je aplikací SGML ({\it
Standard Generalized Markup Language}), univerzálního jazyka pro značkování
dokumentů\footnote{HTML se aplikací SGML stalo ve verzi 2.0 a od
připravované verze 5 se opět od tohoto vztahu upouští.}.

HTML disponuje množinou elementů, jež je možné použít k značkování
dokumentu (např. {\tt <p>Text odstavce</p>}). To má za výsledek
přiřazování významu částem textu a možnost odlišení jejich zpracování
či zobrazení. Bohužel sémantická vybavenost HTML již příliš
nepostačuje dnešním potřebám a proto se můžeme setkat s aktivitami
jako např. mikroformáty (viz \ref{microformats}) nebo snahami o
posílení sémantiky v právě připravované verzi, HTML5.

Značky v rámci zápisu dokumentu tvoří stromovou strukturu. Této
skutečnosti využívá technologie DOM (viz \ref{javaScript}). Informaci
o tom, kde může být jaký element a co může obsahovat se nachází v
tzv. DTD ({\it Document Type Definition}), připojovaném na samý
začátek HTML dokumentu. Jazyk HTML má DTD už připravená k použití
(např. \url{http://www.w3.org/TR/html4/strict.dtd}) a připojují se
prakticky bezvýhradně externím odkazem. Nejen v závislosti na
použitém typu DTD prohlížeče často mění zpracování šablony dokumentu,
především jejích stylů. DTD lze použít i pro XML, ale pro něj je lepší
použít sofistikovanější nástroje jako např. XML Schema. 

\subsection{Výběr HTML místo XHTML}
O vývoj jazyka HTML a souvisejících webových standardů se stará
sdružení internetových firem, výrobců prohlížečů a jiných
zainteresovaných subjektů, W3C ({\it World Wide Web Consortium}). Po
uvedení velmi úspěšného formátu XML přišla tato organizace s
myšlenkou transformovat HTML na aplikaci tohoto univerzálního
značkovacího jazyka. Výsledkem snah se stal jazyk XHTML, tedy {\it
Extensible Hypertext Markup Language}. S jeho uvedením byl vývoj 
\uv{starého} HTML oficiálně ukončen v poslední verzi 4.01.

W3C poté pokračovalo ve vývoji XHTML 2.0, které mělo být navíc již
zcela nekompatibilní s původním HTML. První verze XHTML však
nepřinesly do HTML nic nového a v podstatě způsobovaly jen problémy navíc:

\begin{itemize}
	\item Špatná podpora správného MIME typu XHTML {\tt
	application/xhtml+xml} ze strany nejrozšířenějšího prohlížeče,
	Internet Exploreru, nasazení \uv{opravdového} XHTML v praxi zcela
	znemožňovala.
	\item Počet elementů zůstal oproti HTML de facto nezměněn.
	\item Syntaktická striktnost parseru XHTML po vzoru XML sice
	nedovolovala vývojáři dělat chyby, ale ty bohužel v praxi nevznikají
	jen jeho přičiněním. Nekorektnost zápisu přitom způsobovala ukončení
	zpracování dokumentu a nedostupnost jeho obsahu.
	\item Rozšiřitelnost, hlavní lákadlo XHTML (viz jeho název), nebylo
	v praxi příliš využíváno. 
\end{itemize}

Vývoj standardu XHTML 2.0 ve W3C později navíc téměř ustrnul. Když
webdesignerská obec objevila problémy XHTML a pochopila, že cesta k
XML byla slepá, začala vznikat iniciativa WHATWG Iana
Hicksona. Ta oslovila tvůrce prohlížečů a začala v konsensu s nimi
vyvíjet novou specifikaci jazyka HTML nazývanou HTML5. Akt se setkal
s velkým ohlasem, protože WHATWG se snaží do jazyka promítnout
požadavky dnešních vývojářů webových aplikací a řešit existující
problémy jako nepostačující sada formulářových prvků, slabá sémantika
dokumentu, značky pro audio a video aj.

Za datum definitivní změny směru vývoje lze považovat 7. březen 2007,
kdy W3C založilo novou pracovní skupinu HTML, v níž se prakticky spojilo
s aktivitami WHATWG, uznalo HTML5 jako budoucnost webu a vzalo
jej pod svou hlavičku.

Na základě všech těchto skutečností jsem se rozhodl pro práci použít
jazyk HTML a vyhnout se XHTML, zjevně již neperspektivní technologii.

\subsection{Styly pomocí CSS}
\ldots

\subsection{Skriptovací jazyk JavaScript a DOM}\label{javaScript}
ecmascript/javascript, dom\ldots

JavaScript je dnes pod názvem ECMAScript standardizován na základě
konsensu výrobců prohlížečů, takže jeho použití již není tak frustrující jako v
dřívějších letech, kdy byl interpretován pokaždé jinak.

\subsection{Asynchronní požadavky}\label{ajax}
ajax

\subsection{Framework MooTools}
i jine fw, vylepseni, odstineni, dom, vyhody fw obecne

\section{Serverová část}
generovani ux na serveru
\subsection{Jazyk PHP}
\ldots
\subsection{Systém řízení báze dat MySQL}
\ldots
\subsection{Nette Framework}
nette, dibi\ldots

\section{Práce s API}\label{api}
API služeb relevantních pro tento projekt je poskytováno v zásadě
dvěma způsoby. Dodavatelé se většinou vyhýbají složitým protokolům či
technologiím a nabízejí jednoduchá a přístupná aplikační rozhraní.
Funkčnost API tak lze získat buď přímo pomocí vzdálených souborů s
kódem v jazyce JavaScript (viz \ref{javaScript}), nebo, pokud služba
nabízí data přímo, pomocí rozhraní REST ({\it Representational State
Transfer}, \ref{rest}).

\subsection{Vzdálené volání skriptů}
Skripty připojujeme jako běžně v hlavičce či těle HTML
dokumentu, akorát využíváme vzdálených souborů namísto lokálních.
Vzdálené soubory se skripty jsou většinou vázány na tzv. {\it API
klíč}, který je zapotřebí vygenerovat zpravidla pro doménu, na níž má
probíhat provoz aplikace. Při použití na jiném serveru potom API
nefunguje a je potřeba vygenerovat nový klíč. Poskytovatelé díky tomu
mohou kontrolovat dodržování podmínek použití API, např. limity
požadavků aj. Kontrola klíče je často inteligentní a není aplikována
při použití na vlastním stroji (IP adresa 127.0.0.1, tzv. {\it
localhost}) za účely vývoje a ladění aplikace. Zajímavá možnost je
připojovat a odpojovat skripty k dokumentu dynamicky, pomocí jiného
řídícího skriptu a technologie DOM (viz \ref{javaScript}).

\subsection{Technologie REST}\label{rest}
REST je architektura představená v roce 2000 jedním z autorů
specifikace protokolu HTTP \cite{rest}. Pro naše účely by API v
podobě REST šlo ve zkratce popsat jako technologii, v níž poskytovatel dat zveřejní webové URI, MIME typ odpovědi a množinu operací, které jsou k dispozici přes HTTP metody POST, GET, PUT nebo DELETE. V praxi
potom máme například adresu {\tt \url{ws.geonames.org/gtopo30JSON}},
víme z dokumentace GeoNames.org, že můžeme použít parametry {\tt lat} a {\tt
lng} pro určení souřadnic a že výsledkem bude JSON s nadmořskou
výškou. Když tedy vytvoříme požadavek na adresu
{\tt \url{http://ws.geonames.org/gtopo30JSON?lat=47.01&lng=10.2}},
dostaneme přes HTTP patřičnou odpověď ve formátu JSON.

Z formátů odpovědí jsou nej\-využívanější obyčejný text, XML (\ref{xml})
a JSON (\ref{json}). Vyjímečně se lze také u specifických služeb
setkat s jinými, jako např. u Google Chart API, kde lze přes REST
pohodlně vygenerovat obrázek s grafem (použití v \ref{grafy}).

\subsection{Univerzální jazyk XML}\label{xml}
zakladni uvedeni do problematiky, vyhody nevyhody\ldots
jen mala zminka, pro uplnost
\subsection{Lidsky čitelný JSON}\label{json}
vyhody nevyhody\ldots
REST (odkaz nahoru), JSON (vysvetleni formatu)

\chapter{Návrh systému}
navrh databaze, mozna use case, popis celkoveho reseni systemu,

\chapter{Implementace}
struktura portalu, viz 9193 str 26

detaily v kapitolkach o jednotlivych problemech jako pocitani ruznych bodu na mape, reseni prodlev dat
dodavanych z api, zdvojovani api apod.

rozepsani detailneji nez v minule kapitole o tom kde je javascript,
co dela, jak je implementovano ukladani, kresleni car na tu mapu
apod. detaily

Při zaznamenávání dat je důležité si uvědomit, že pokud známe
nadmořskou výšku dvou bodů, neznamená to, že mezi nimi existuje
lineární spojnice (např. mezi body Praha a Brno jistě nebude jen
pozvolné stoupání vyrovnávající rozdíl nadmořských výšek těchto
měst). Správně by měl systém dopočítávat mezibody na relevantních
intervalech a zjišťovat nadmořskou výšku i na nich. To by však mohlo
vést k velkému provozu na API pro zjištění výškopisu a také k velkým
prodlevám. \ldots

\chapter{Vývoj a testování}
verze vyvojovych nastroju, verze mootools, nette, eclipse, apache,
php, mysql, testovane prohlizece

\chapter*{Závěr}
dosazene vysledky a prinos prace

Závěrečná kapitola obsahuje zhodnocení dosažených výsledků se zvlášť
vyznačeným vlastním přínosem studenta. Povinně se zde objeví i
zhodnocení z pohledu dalšího vývoje projektu, student uvede náměty
vycházející ze zkušeností s řešeným projektem a uvede rovněž
návaznosti na právě dokončené projekty (řešené v rámci ostatních
bakalářských prací v daném roce nebo na projekty řešené na externích
pracovištích).
